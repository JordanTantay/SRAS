    <!DOCTYPE html>
    {% load tz %}
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>SRAS - Dashboard</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <style>
            .triangle-pointer {
                width: 0;
                height: 0;
                border-left: 18px solid transparent;
                border-right: 18px solid transparent;
                border-bottom: 18px solid #fff;
                /* Remove shadow for seamless blend */
                box-shadow: none;
            }
            /* Sidebar active link background highlight */
            .sidebar .nav-link.active {
                background: #428aba !important;
                color: #fff !important;
                border-radius: 8px;
            }
            /* Make dropdown items white text on hover for week filter */
            .dropdown-menu .week-filter-option:hover,
            .dropdown-menu .week-filter-option:focus {
                background-color: #2ecc40 !important;
                color: #fff !important;
            }
            /* Make main week filter button text white on hover/focus */
            .week-filter-main-btn:hover,
            .week-filter-main-btn:focus {
                color: #fff !important;
                background-color: #2ecc40 !important;
                border-color: #2ecc40 !important;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #456882;
                min-height: 100vh;
                margin-top: 20px;
                padding: 0;
            }

            /* --- Improved Button Cards --- */
            .action-card {
                background: linear-gradient(135deg, #f8fafc 0%, #eaf6fb 100%);
                border: 2.5px solid transparent;
                box-shadow: 0 4px 24px rgba(52, 152, 219, 0.10), 0 1.5px 8px rgba(44, 62, 80, 0.06);
                transition:
                    box-shadow 0.25s cubic-bezier(0.23, 1, 0.32, 1),
                    border-color 0.25s cubic-bezier(0.23, 1, 0.32, 1),
                    background 0.25s cubic-bezier(0.23, 1, 0.32, 1),
                    transform 0.18s cubic-bezier(0.23, 1, 0.32, 1);
                border-radius: 18px !important;
                padding: 18px 18px 18px 18px !important;
                min-height: 110px;
                cursor: pointer;
                position: relative;
                overflow: hidden;
            }
            .action-card:hover, .action-card.active {
                background: linear-gradient(135deg, #eaf6fb 0%, #f8fafc 100%);
                box-shadow: 0 8px 32px rgba(52, 152, 219, 0.18), 0 2px 12px rgba(44, 62, 80, 0.10);
                transform: translateY(-2px) scale(1.025);
            }
            .action-card .stats-icon {
                box-shadow: 0 2px 12px rgba(52, 152, 219, 0.13);
                border: 3px solid #fff;
            }
            .action-card .d-flex.flex-column {
                align-items: flex-start !important;
            }
            .action-card .d-flex.flex-column span:first-child {
                font-size: 1.45em !important;
                font-weight: 800 !important;
                letter-spacing: 0.5px;
                margin-bottom: 2px;
            }
            .action-card .d-flex.flex-column span:last-child {
                font-size: 1.08em !important;
                font-weight: 600 !important;
                color: #234C6A !important;
                opacity: 0.92;
            }
            @media (max-width: 768px) {
                .action-card {
                    padding: 12px 8px !important;
                    min-height: 80px;
                }
                .action-card .d-flex.flex-column span:first-child {
                    font-size: 1.1em !important;
                }
                .action-card .d-flex.flex-column span:last-child {
                    font-size: 0.98em !important;
                }
            }

            .navbar {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%) !important;
                padding: 15px 0;
                position: sticky;
                top: 0;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .navbar-brand {
                font-weight: 600;
                font-size: 1.5rem;
                color: white !important;
            }

            .nav-link {
                color: rgba(255, 255, 255, 0.8) !important;
                transition: color 0.3s ease;
                font-weight: 500;
            }

            .nav-link:hover,
            .nav-link.active {
                color: white !important;
            }

            .navbar-toggler {
                border: none;
                color: white;
            }

            .navbar-toggler:focus {
                box-shadow: none;
            }

            .stats-card,
            .recent-violations{
                background: white;
                border-radius: 18px;
                box-shadow: 0 8px 32px rgba(44, 62, 80, 0.10);
            }

            .recent-violations {
                opacity: 0;
                transform: translateY(40px) scale(0.98);
                animation: recentSlideUp 0.8s cubic-bezier(0.23, 1, 0.32, 1) 0.2s forwards;
            }

            @keyframes recentSlideUp {
                0% {
                    opacity: 0;
                    transform: translateY(40px) scale(0.98);
                }

                60% {
                    opacity: 0.7;
                    transform: translateY(-8px) scale(1.02);
                }

                100% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            @keyframes quickSlideLeft {
                0% {
                    opacity: 0;
                    transform: translateX(60px) scale(0.98);
                }

                60% {
                    opacity: 0.7;
                    transform: translateX(-8px) scale(1.02);
                }

                100% {
                    opacity: 1;
                    transform: translateX(0) scale(1);
                }
            }

            .card.h-100 {
                opacity: 1 !important;
                transform: none !important;
                animation: none !important;
            }

            /* Remove graph card animation keyframes */
            /* @keyframes violationSlideRight { ... } */

            .stats-card {
                padding: 28px 24px;
                border: 2px solid #eaf6fb;
                min-height: 140px;
                opacity: 0;
                transform: translateY(40px) scale(0.96);
                animation: cardFadeIn 0.9s cubic-bezier(0.23, 1, 0.32, 1) forwards;
                transition:
                    box-shadow 0.35s cubic-bezier(0.23, 1, 0.32, 1),
                    transform 0.35s cubic-bezier(0.23, 1, 0.32, 1),
                    background 0.35s cubic-bezier(0.23, 1, 0.32, 1),
                    border-color 0.35s cubic-bezier(0.23, 1, 0.32, 1);
            }

            @keyframes cardFadeIn {
                0% {
                    opacity: 0;
                    transform: translateY(40px) scale(0.96);
                }

                60% {
                    opacity: 0.7;
                    transform: translateY(-8px) scale(1.02);
                }

                100% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .stats-card:hover {
                transform: translateY(-5px) scale(1.03);
                box-shadow: 0 12px 32px rgba(52, 152, 219, 0.18);
                background: #f8fafd;
                border-color: #3498db;
            }

            .stats-icon {
                width: 64px;
                height: 64px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.1rem;
                color: white;
                box-shadow: 0 4px 16px rgba(52, 152, 219, 0.12);
            }

            .bg-primary-gradient {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            .bg-success-gradient {
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            }

            .bg-warning-gradient {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }

            .bg-info-gradient {
                background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            }

            .bg-secondary-gradient {
                background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            }

            .action-card {
                text-align: center;
                padding: 10px 8px 8px 8px;
                border-radius: 10px;
                transition: all 0.2s cubic-bezier(0.23, 1, 0.32, 1);
                cursor: pointer;
                min-height: 64px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                box-shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
                border-width: 1.5px !important;
            }

            .action-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            .action-icon, .stats-icon {
                font-size: 1.4rem !important;
                width: 40px !important;
                height: 40px !important;
                margin-bottom: 6px !important;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .alert {
                border-radius: 8px;
                margin-bottom: 20px;
                font-size: 0.95rem;
            }

            .card-body h2,
            .stats-card h3 {
                font-size: 2.2rem;
                font-weight: 700;
                color: #234C6A;
            }

            .btn-sm {
                min-height: 32px;
                font-size: 14px;
            }

            .stat-overview-animate {
                opacity: 0;
                transform: translateY(-60px) scale(0.98);
                animation: statOverviewSlideDown 0.8s cubic-bezier(0.23, 1, 0.32, 1) 0.1s forwards;
            }

            @keyframes statOverviewSlideDown {
                0% {
                    opacity: 0;
                    transform: translateY(-60px) scale(0.98);
                }

                60% {
                    opacity: 0.7;
                    transform: translateY(8px) scale(1.02);
                }

                100% {
                    opacity: 1;
                    transform: translateY(0) scale(1);
                }
            }

            .recent-violations-table thead th {
                background: #f8fafd !important;
                border-bottom: 2px solid #f093fb !important;
            }

            .recent-violations-table tbody tr:hover {
                background: #f3f0fa !important;
            }

            .recent-violations-table td,
            .recent-violations-table th {
                vertical-align: middle;
            }

            @media (max-width: 768px) {
                .main-container {
                    margin-top: 10px;
                }

                .stats-card,
                .recent-violations{
                    padding: 12px;
                }

                .action-card {
                    padding: 12px;
                    min-height: 100px;
                }

                .action-icon {
                    font-size: 1.5rem;
                    margin-bottom: 8px;
                }

                .card-body h2,
                .stats-card h3 {
                    font-size: 1.5rem;
                }
            }
        </style>
    </head>

    <body>
        <!-- Sidebar Navigation -->
        <div style="display: flex; min-height: 100vh;">
            <nav id="sidebar" class="sidebar" style="width: 240px; background: #234C6A; color: #fff; position: fixed; top: 0; left: 0; height: 100vh; z-index: 1100; display: flex; flex-direction: column; box-shadow: 2px 0 10px rgba(0,0,0,0.08); transition: width 0.2s;">
                <div style="padding:10px 16px 10px; border-bottom: 1px solid rgba(255,255,255,0.08);">
                    <a class="navbar-brand" href="{% url 'dashboard' %}" style="color: #fff; font-size: 1.7rem; font-weight: 700; text-decoration: none;">
                        <i class="fas fa-shield-alt"></i> SRAS </a>
                </div>
                <ul class="nav flex-column mt-4" style="flex: 1;">
                    <li class="nav-item mb-2">
                        <a class="nav-link active" href="{% url 'dashboard' %}" style="color: #fff; font-weight: 500;">
                            <i class="fas fa-tachometer-alt me-2"></i> Dashboard </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'monitor' %}" style="color: #fff;">
                            <i class="fas fa-video me-2"></i> Live Monitor </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'violation_list' %}" style="color: #fff;">
                            <i class="fas fa-list me-2"></i> Violations </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'enforcer_list' %}" style="color: #fff;">
                            <i class="fas fa-users me-2"></i> Enforcers </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a class="nav-link" href="{% url 'pending_violation' %}" style="color: #fff;">
                            <i class="fas fa-exclamation-circle me-2"></i> Pending Violations </a>
                    </li>
                </ul>
                <div style="padding: 16px 24px; border-top: 1px solid rgba(255,255,255,0.08);">
                    <div class="dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="sidebarDropdown" role="button" data-bs-toggle="dropdown" style="color: #fff;">
                            <i class="fas fa-user"></i> <span class="d-none d-md-inline">{{ user.username }}</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{% url 'logout' %}">
                                    <i class="fas fa-sign-out-alt"></i> Logout </a></li>
                        </ul>
                    </div>
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const sidebar = document.getElementById('sidebar');
                        const mainContainer = document.querySelector('.main-container');
                        let collapsed = false;

                        function setSidebarTextVisibility(hide) {
                            console.log('[Sidebar] setSidebarTextVisibility called, hide:', hide);
                            sidebar.querySelectorAll('.nav-link, .navbar-brand, .dropdown-toggle').forEach(el => {
                                el.childNodes.forEach(node => {
                                    if (node.nodeType === Node.TEXT_NODE) {
                                        if (hide) {
                                            if (!node._originalText) node._originalText = node.textContent;
                                            node.textContent = '';
                                        } else {
                                            node.textContent = node._originalText || node.textContent;
                                        }
                                    } else if (node.nodeType === Node.ELEMENT_NODE && node.tagName !== 'I') {
                                        if (hide) {
                                            if (!node.dataset.originalDisplay) node.dataset.originalDisplay = node.style.display;
                                            node.style.display = 'none';
                                        } else {
                                            node.style.display = node.dataset.originalDisplay || '';
                                        }
                                    }
                                });
                            });
                            sidebar.querySelectorAll('.dropdown, .sidebar-admin').forEach(adminSection => {
                                adminSection.querySelectorAll('*').forEach(child => {
                                    if (child.tagName !== 'I') {
                                        if (hide) {
                                            if (!child.dataset.originalDisplay) child.dataset.originalDisplay = child.style.display;
                                            child.style.display = 'none';
                                        } else {
                                            child.style.display = child.dataset.originalDisplay || '';
                                        }
                                    }
                                });
                                adminSection.childNodes.forEach(node => {
                                    if (node.nodeType === Node.TEXT_NODE) {
                                        if (hide) {
                                            if (!node._originalText) node._originalText = node.textContent;
                                            node.textContent = '';
                                        } else {
                                            node.textContent = node._originalText || node.textContent;
                                        }
                                    }
                                });
                            });
                        }

                        function collapseSidebar() {
                            collapsed = true;
                            sidebar.style.width = '60px';
                            mainContainer.style.marginLeft = '60px';
                            mainContainer.style.width = 'calc(100% - 60px)';
                            setSidebarTextVisibility(true);
                            console.log('[Sidebar] Collapsed');
                        }

                        function expandSidebar() {
                            collapsed = false;
                            sidebar.style.width = '240px';
                            mainContainer.style.marginLeft = '240px';
                            mainContainer.style.width = 'calc(100% - 240px)';
                            setSidebarTextVisibility(false);
                            console.log('[Sidebar] Expanded');
                        }
                        sidebar.addEventListener('mouseenter', function() {
                            if (collapsed) {
                                console.log('[Sidebar] Mouse enter, expanding');
                                expandSidebar();
                            }
                        });
                        sidebar.addEventListener('mouseleave', function() {
                            if (!collapsed) {
                                console.log('[Sidebar] Mouse leave, collapsing');
                                collapseSidebar();
                            }
                        });
                    });
                </script>
            </nav>
            <div class="main-container" style="margin-left: 240px; width: calc(100% - 240px); padding-left: 32px; padding-right: 32px;"> {% if messages %} {% for message in messages %} <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <i class="fas fa-{% if message.tags == 'error' %}exclamation-triangle{% else %}check-circle{% endif %}"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div> {% endfor %} {% endif %}
                <!-- Welcome Popup (fades out) --> {% if show_welcome_popup %} <div id="welcomePopup" class="position-fixed top-0 start-50 translate-middle-x" style="z-index: 2000; margin-top: 32px; min-width: 320px; max-width: 90vw;">
                    <div class="alert alert-primary d-flex align-items-center shadow-lg" style="font-size: 1.1rem; border-radius: 12px; padding: 18px 28px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border: none;">
                        <i class="fas fa-sun me-3" style="font-size: 1.7rem;"></i>
                        <div>
                            <strong>Welcome back, {{ user.username }}!</strong>
                            <div style="font-size: 1rem; opacity: 0.95;">Here's what's happening with your Safe Road Alert System today.</div>
                        </div>
                    </div>
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        setTimeout(function() {
                            const popup = document.getElementById('welcomePopup');
                            if (popup) {
                                popup.style.transition = 'opacity 1s';
                                popup.style.opacity = '0';
                                setTimeout(() => popup.remove(), 1200);
                            }
                        }, 2200);
                    });
                </script> {% endif %}
                <!-- Button Cards for Today, This Week, This Month -->
                <div class="row mb-4 justify-content-center" style="gap: 0;">
                    <div class="col-12" style="margin-bottom: 0;">
                        <!-- LOG: New dashboard layout for horizontal cards/graphs and tall enforcer card -->
                        <div class="d-flex flex-row" style="width: 100%; gap: 24px;">
                            <!-- Left column: horizontal cards and graphs -->
                            <div style="display: flex; flex-direction: column; flex:1.2; min-width: 0;">
                                <!-- LOG: Horizontal row of button cards -->
                                <div style="display: flex; flex-direction: row; gap: 16px; width: 100%;">
                                    <!-- Today Card -->
                                    <div style="flex:1;">
                                        <div class="stats-card action-card d-flex align-items-center justify-content-center" id="card-today" style="margin:0 2px;">
                                            <div class="d-flex flex-row align-items-center justify-content-center w-100">
                                                <div class="stats-icon bg-primary-gradient d-flex align-items-center justify-content-center" style="margin:0 14px 0 0;">
                                                    <i class="fas fa-calendar-day"></i>
                                                </div>
                                                <div class="d-flex flex-column" style="flex:1;">
                                                    <span style="color:#3498db;">{{ today_violations }}</span>
                                                    <span>Today</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- This Week Card -->
                                    <div style="flex:1;">
                                        <div class="stats-card action-card d-flex align-items-center justify-content-center" id="card-week" style="margin:0 2px;">
                                            <div class="d-flex flex-row align-items-center justify-content-center w-100">
                                                <div class="stats-icon bg-warning-gradient d-flex align-items-center justify-content-center" style="margin:0 14px 0 0;">
                                                    <i class="fas fa-calendar-week"></i>
                                                </div>
                                                <div class="d-flex flex-column" style="flex:1;">
                                                    <span style="color:#f7971e;">{{ this_week_violations }}</span>
                                                    <span>This Week</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- This Month Card -->
                                    <div style="flex:1;">
                                        <div class="stats-card action-card d-flex align-items-center justify-content-center" id="card-month" style="margin:0 2px;">
                                            <div class="d-flex flex-row align-items-center justify-content-center w-100">
                                                <div class="stats-icon bg-success-gradient d-flex align-items-center justify-content-center" style="margin:0 14px 0 0;">
                                                    <i class="fas fa-calendar-alt"></i>
                                                </div>
                                                <div class="d-flex flex-column" style="flex:1;">
                                                    <span style="color:#11998e;">{{ this_month_violations }}</span>
                                                    <span>This Month ({{ current_month_name }})</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- LOG: Single wide graph row spanning all three cards -->
                                <div style="width: 100%; margin-top: 12px;">
                                    <!-- Today Graph -->
                                    <div class="card h-100" id="section-today" style="border-radius: 10px; padding: 10px 20px; background: #fff; width:100%; min-width:180px; margin-top: 12px; position:relative;">
                                        <!-- Triangle pointer for Today graph -->
                                        <div class="triangle-pointer" style="position:absolute; top:-18px; left:15%; transform:translateX(-50%);"></div>
                                        <div class="card-body" style="padding: 0; width: 100%;">
                                            <div class="chart-container" style="position: relative; width: 100%; height: 340px; margin: 0;">
                                                <canvas id="todayHourlyChart" style="width:100%;height:100%;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- This Week Graph -->
                                    <div class="card h-100" id="section-week" style="border-radius: 10px; padding: 10px 20px; background: #fff; width:100%; min-width:180px; margin-top: 12px; position:relative;">
                                        <!-- Triangle pointer for This Week graph -->
                                        <div class="triangle-pointer" style="position:absolute; top:-18px; left:50%; transform:translateX(-50%);"></div>
                                        <div class="card-body" style="padding: 0; width: 100%;">
                                            <div class="chart-container" style="position: relative; width: 100%; height: 340px; margin: 0;">
                                                <canvas id="weeklyViolationsChart" style="width:100%;height:100%;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- This Month Graph -->
                                    <div class="card h-100" id="section-month" style="border-radius: 10px; padding: 10px 20px; background: #fff; width:100%; min-width:180px; margin-top: 12px; position:relative;">
                                        <!-- Triangle pointer for This Month graph -->
                                        <div class="triangle-pointer" style="position:absolute; top:-18px; left:85%; transform:translateX(-50%);"></div>
                                        <div class="card-body" style="padding: 0; width: 100%;">
                                            <div class="chart-container" style="position: relative; width: 100%; height: 340px; margin: 0;">
                                                <canvas id="monthlyViolationsChart" style="width:100%;height:100%;"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- LOG: Enforcer Pie/Doughnut Card (side of "This Month" card) -->
                            <div class="stats-card action-card d-flex align-items-center justify-content-center" id="card-enforcer" style="flex:1.5; min-width:0; margin:0 2px; max-width:400px; align-self: stretch; height: 500px;">
                                <div class="d-flex flex-row align-items-center justify-content-center w-100">
                                    <div class="stats-icon bg-info-gradient d-flex align-items-center justify-content-center" style="margin:0 14px 0 0;">
                                        <i class="fas fa-user-shield"></i>
                                    </div>
                                    <div class="d-flex flex-column" style="flex:1;">
                                        <span style="color:#4facfe;">{{ total_enforcers }}</span>
                                        <span>Enforcers</span>
                                    </div>
                                </div>
                                <!-- DEBUG: Maximized doughnut chart container for enforcer card -->
                                <div style="flex:1; display:flex; align-items:center; justify-content:center; height:100%;">
                                    <canvas id="enforcerPieChart" style="width:300px;height:300px;max-width:300px;max-height:300px;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const ctx = document.getElementById('enforcerPieChart').getContext('2d');
                        const data = {
                            labels: ['Active', 'Inactive'],
                            datasets: [{
                                data: [parseInt("{{ active_enforcers|default:'0' }}", 10), parseInt("{{ inactive_enforcers|default:'0' }}", 10)],
                                backgroundColor: [
                                    'rgba(46, 204, 113, 0.7)',
                                    'rgba(231, 76, 60, 0.7)'
                                ],
                                borderColor: [
                                    'rgba(46, 204, 113, 1)',
                                    'rgba(231, 76, 60, 1)'
                                ],
                                borderWidth: 2
                            }]
                        };
                        const options = {
                            responsive: true,
                            maintainAspectRatio: false,
                            cutout: '75%',
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'bottom',
                                    labels: {
                                        font: {
                                            size: 18,
                                            weight: 'bold'
                                        },
                                        color: '#234C6A',
                                        boxWidth: 22,
                                        boxHeight: 18,
                                        borderRadius: 18,
                                        padding: 20
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Enforcer Status',
                                    color: '#4facfe',
                                    font: {
                                        size: 20,
                                        weight: 'bold'
                                    },
                                    padding: {top: 10, bottom: 20}
                                },
                                tooltip: {
                                    enabled: true,
                                    backgroundColor: '#fff',
                                    titleColor: '#234C6A',
                                    bodyColor: '#234C6A',
                                    borderColor: '#4facfe',
                                    borderWidth: 1.5,
                                    padding: 12,
                                    callbacks: {
                                        label: function(context) {
                                            return `${context.label}: ${context.parsed}`;
                                        }
                                    }
                                }
                            }
                        };
                        new Chart(ctx, {
                            type: 'doughnut',
                            data: data,
                            options: options
                        });
                    });
                </script>
                <!-- Stats/Graphs Sections (toggle visibility) -->
                <div class="row mb-4 justify-content-center" style="gap: 0;">
                    <div class="col-12" style="margin-bottom: 0;">
                        <div class="card h-100" id="section-today" style="border-radius: 10px; padding: 10px 20px; background: #fff; width:100%; display:none; position:relative;">
                            <!-- Triangle pointer for debugging placement -->
                            <div class="triangle-pointer" style="position:absolute; top:-18px; left:15%; transform:translateX(-50%);"></div>
                            <div class="card-body" style="padding: 0;">
                                <div class="chart-container" style="position: relative; width: 100%; height: 340px; margin: 0;">
                                    <canvas id="todayHourlyChart" style="width:100%;height:100%;"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="card h-100 position-relative" id="section-week" style="border-radius: 10px; padding: 16px 20px; background: #fff; width:100%; min-height:400px; margin-bottom: 24px; display:none; position:relative;">
                            <!-- Triangle pointer for "This Week" card, visually centered -->
                            <div class="triangle-pointer" style="position:absolute; top:-18px; left:50%; transform:translateX(-50%);"></div>
                            <div class="d-flex flex-column align-items-center justify-content-center" style="width: 100%; height: 340px; margin: 0;">
                                <div class="chart-container" style="width: 90%; height: 500px; display: flex; align-items: center; justify-content: center;">
                                    <canvas id="weeklyViolationsChart" style="width:100%;height:100%;display:block;"></canvas>
                                </div>
                            </div>
                            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                            <script>
                                // This script loads real week statistics from /api/statistics/
                                document.addEventListener('DOMContentLoaded', function() {
                                    fetch('/api/statistics/').then(response => response.json()).then(data => {
                                        let stats = data.week_statistics || [];
                                        const ctx = document.getElementById('weeklyViolationsChart').getContext('2d');
                                        const labels = stats.map(stat => stat.label);
                                        const counts = stats.map(stat => stat.count);
                                        new Chart(ctx, {
                                            type: 'line',
                                            data: {
                                                labels: labels,
                                                datasets: [{
                                                    label: 'Violations',
                                                    data: counts,
                                                    backgroundColor: [
                                                        'rgba(247, 151, 30, 0.25)'
                                                    ],
                                                    borderColor: [
                                                        '#f7971e'
                                                    ],
                                                    borderWidth: 3,
                                                    borderRadius: 12,
                                                    maxBarThickness: 38,
                                                    hoverBackgroundColor: [
                                                        'rgba(46, 204, 113, 1)',
                                                        'rgba(52, 152, 219, 1)',
                                                        'rgba(241, 196, 15, 1)',
                                                        'rgba(231, 76, 60, 1)',
                                                        'rgba(155, 89, 182, 1)',
                                                        'rgba(243, 156, 18, 1)',
                                                        'rgba(39, 174, 96, 1)'
                                                    ]
                                                }]
                                            },
                                            options: {
                                                responsive: true,
                                                maintainAspectRatio: false,
                                                plugins: {
                                                    legend: {
                                                        display: false
                                                    },
                                                    title: {
                                                        display: true,
                                                        color: '#f7971e',
                                                        font: {
                                                            size: 24,
                                                            weight: 'bold',
                                                            family: 'Segoe UI'
                                                        },
                                                        padding: {top: 10, bottom: 20}
                                                    },
                                                    tooltip: {
                                                        enabled: true,
                                                        backgroundColor: '#fff',
                                                        titleColor: '#234C6A',
                                                        bodyColor: '#234C6A',
                                                        borderColor: '#f7971e',
                                                        borderWidth: 1.5,
                                                        padding: 12,
                                                        callbacks: {
                                                            label: function(context) {
                                                                return `Violations: ${context.parsed.y}`;
                                                            }
                                                        }
                                                    }
                                                },
                                                scales: {
                                                    x: {
                                                        grid: {
                                                            color: 'rgba(46, 204, 113, 0.08)',
                                                            borderDash: [4, 4]
                                                        },
                                                        ticks: {
                                                            color: '#234C6A',
                                                            font: {
                                                                weight: 'bold',
                                                                size: 16
                                                            }
                                                        }
                                                    },
                                                    y: {
                                                        beginAtZero: true,
                                                        grid: {
                                                            color: 'rgba(46, 204, 113, 0.12)',
                                                            display: true,
                                                            drawBorder: true,
                                                            drawOnChartArea: true,
                                                            drawTicks: true
                                                        },
                                                        ticks: {
                                                            color: '#234C6A',
                                                            font: {
                                                                weight: 'bold',
                                                                size: 16
                                                            },
                                                            stepSize: 1,
                                                            maxTicksLimit: 11
                                                        }
                                                    }
                                                },
                                                animation: {
                                                    duration: 1200,
                                                    easing: 'easeOutQuart'
                                                }
                                            }
                                        });
                                    });
                                });
                            </script>
                        </div>
                        <div class="card h-100" id="section-month" style="border-radius: 10px; padding: 16px 20px; background: #fff; width:100%; display:none; position:relative;">
                            <!-- Triangle pointer for "This Month" card, visually centered -->
                            <div class="triangle-pointer" style="position:absolute; top:-18px; left:85%; transform:translateX(-50%);"></div>
                            <div class="chart-container" style="width: 98%; height: 340px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="monthlyViolationsChart" style="width:100%;height:100%;display:block;"></canvas>
                            </div>
                            <script>
                                // Multi-line chart for all 4 weeks (legend: Week 1-4, x-axis: Sun-Sat)
                                document.addEventListener('DOMContentLoaded', function() {
                                    let weekDaily = [];
                                    let chart = null;
                                    const ctx = document.getElementById('monthlyViolationsChart').getContext('2d');
                                    // Color palette for up to 4 lines
                                    const palette = [
                                        'rgba(46, 204, 113, 0.25)',
                                        'rgba(52, 152, 219, 0.25)',
                                        'rgba(241, 196, 15, 0.25)',
                                        'rgba(231, 76, 60, 0.25)'
                                    ];
                                    const borderPalette = [
                                        'rgba(46, 204, 113, 1)',
                                        'rgba(52, 152, 219, 1)',
                                        'rgba(241, 196, 15, 1)',
                                        'rgba(231, 76, 60, 1)'
                                    ];
                                    function renderMultiLineChart(weekDaily) {
                                        if (chart) chart.destroy();
                                        // Find all unique day labels (Sun-Sat)
                                        const allLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                                        // Build datasets for each week
                                        const datasets = weekDaily.map((week, idx) => {
                                            // Map day labels to counts, fill missing days with 0
                                            const dayCounts = allLabels.map(dayLabel => {
                                                const dayObj = week.days.find(d => d.label === dayLabel);
                                                return dayObj ? dayObj.count : 0;
                                            });
                                            return {
                                                label: week.label,
                                                data: dayCounts,
                                                fill: false,
                                                backgroundColor: palette[idx % palette.length],
                                                borderColor: borderPalette[idx % borderPalette.length],
                                                borderWidth: 2,
                                                tension: 0.4,
                                                pointRadius: 7,
                                                pointBackgroundColor: borderPalette[idx % borderPalette.length]
                                            };
                                        });
                                        chart = new Chart(ctx, {
                                            type: "line",
                                            data: {
                                                labels: allLabels,
                                                datasets: datasets
                                            },
                                            options: {
                                                responsive: true,
                                                maintainAspectRatio: false,
                                                plugins: {
                                                    legend: {
                                                        display: true,
                                                        position: 'bottom',
                                                        labels: {
                                                            font: {
                                                                size: 16,
                                                                weight: 'bold'
                                                            },
                                                            boxWidth: 28,
                                                            boxHeight: 14,
                                                            padding: 18,
                                                            usePointStyle: true,
                                                            color: '#11998e'
                                                        }
                                                    },
                                                    title: {
                                                        display: true,
                                                        color: '#11998e',
                                                        font: {
                                                            size: 24,
                                                            weight: 'bold',
                                                            family: 'Segoe UI'
                                                        },
                                                        padding: {top: 10, bottom: 20}
                                                    },
                                                    tooltip: {
                                                        enabled: true,
                                                        backgroundColor: '#fff',
                                                        titleColor: '#234C6A',
                                                        bodyColor: '#234C6A',
                                                        borderColor: '#11998e',
                                                        borderWidth: 1.5,
                                                        padding: 12,
                                                        callbacks: {
                                                            label: function(context) {
                                                                return `${context.dataset.label}: ${context.parsed.y}`;
                                                            }
                                                        }
                                                    }
                                                },
                                                scales: {
                                                    x: {
                                                        grid: {
                                                            color: 'rgba(52, 152, 219, 0.04)',
                                                            display: true,
                                                            borderDash: [4, 4]
                                                        },
                                                        ticks: {
                                                            color: '#234C6A',
                                                            font: {
                                                                weight: 'bold',
                                                                size: 16
                                                            }
                                                        }
                                                    },
                                                    y: {
                                                        beginAtZero: true,
                                                        grid: {
                                                            color: 'rgba(52, 152, 219, 0.08)',
                                                            display: true,
                                                            drawBorder: true,
                                                            drawOnChartArea: true,
                                                            drawTicks: true
                                                        },
                                                        ticks: {
                                                            color: '#234C6A',
                                                            font: {
                                                                weight: 'bold',
                                                                size: 16
                                                            },
                                                            stepSize: 1,
                                                            maxTicksLimit: 11
                                                        }
                                                    }
                                                },
                                                animation: {
                                                    duration: 1200,
                                                    easing: 'easeOutQuart'
                                                }
                                            }
                                        });
                                    }
                                    fetch('/api/statistics/').then(response => response.json()).then(data => {
                                        weekDaily = data.month_weekly_daily || [];
                                        renderMultiLineChart(weekDaily);
                                    });
                                });
                            </script>
                        </div>
                    </div>
                </div>
                <script>
                    // Card click toggling logic with logging
                    document.addEventListener('DOMContentLoaded', function() {
                        function showSection(section) {
                            document.getElementById('section-today').style.display = (section === 'today') ? '' : 'none';
                            document.getElementById('section-week').style.display = (section === 'week') ? '' : 'none';
                            document.getElementById('section-month').style.display = (section === 'month') ? '' : 'none';
                            console.log('[Card Toggle] Showing section:', section);
                        }
                        document.getElementById('card-today').addEventListener('click', function() {
                            showSection('today');
                        });
                        document.getElementById('card-week').addEventListener('click', function() {
                            showSection('week');
                        });
                        document.getElementById('card-month').addEventListener('click', function() {
                            showSection('month');
                        });
                        // Default: show Today
                        showSection('today');
                    });
                </script>
                <script>
                    // Card click toggling logic with logging
                    document.addEventListener('DOMContentLoaded', function() {
                        function showSection(section) {
                            document.getElementById('section-today').style.display = (section === 'today') ? '' : 'none';
                            document.getElementById('section-week').style.display = (section === 'week') ? '' : 'none';
                            document.getElementById('section-month').style.display = (section === 'month') ? '' : 'none';
                            console.log('[Card Toggle] Showing section:', section);
                        }
                        document.getElementById('card-today').addEventListener('click', function() {
                            showSection('today');
                        });
                        document.getElementById('card-week').addEventListener('click', function() {
                            showSection('week');
                        });
                        document.getElementById('card-month').addEventListener('click', function() {
                            showSection('month');
                        });
                        // Default: show Today
                        showSection('today');
                    });
                </script>
                <div class="row mb-2" style="margin-top:0;margin-bottom:0;">
                    <div class="col-12">
                        <div class="recent-violations p-3" style="border-radius: 10px; padding: 12px 24px 18px 24px; margin-top: 0;">
                            <h5 class="mb-3" style="font-weight: bold; color: #f093fb;">
                                <i class="fas fa-clock"></i> Recent Violations <a href="{% url 'violation_list' %}" class="btn btn-sm btn-outline-primary float-end">
                                    <span class="d-none d-sm-inline">View All</span><span class="d-sm-none">All</span>
                                </a>
                            </h5> {% if recent_violations %} <div class="table-responsive" style="padding: 12px;">
                                <table class="table table-hover align-middle mb-0 recent-violations-table" style="border-radius: 14px; overflow: hidden;">
                                    <thead class="table-light">
                                        <tr>
                                            <th style="padding: 16px 18px; font-size:1.08em; color:#764ba2; font-weight:700; border: none;">
                                                <i class="fas fa-id-card"></i> Plate
                                            </th>
                                            <th style="padding: 16px 18px; font-size:1.08em; color:#3498db; font-weight:700; border: none;">
                                                <i class="fas fa-video"></i> Camera
                                            </th>
                                            <th style="padding: 16px 18px; font-size:1.08em; color:#11998e; font-weight:700; border: none;">
                                                <i class="fas fa-clock"></i> Time
                                            </th>
                                            <th style="padding: 16px 18px; text-align: center; font-size:1.08em; color:#f093fb; font-weight:700; border: none;">
                                                <i class="fas fa-cogs"></i> Action
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody> {% for violation in recent_violations %} <tr style="transition: background 0.2s;">
                                            <td style="padding: 14px 18px; font-weight:600; color:#234C6A; background:rgba(118,75,162,0.04); border: none;">
                                                {{ violation.plate_number|default:"Unknown" }}
                                            </td>
                                            <td style="padding: 14px 18px; color:#3498db; background:rgba(52,152,219,0.04); border: none;">
                                                {{ violation.camera.name|default:"Unknown Camera" }}
                                            </td>
                                            <td style="padding: 14px 18px; color:#11998e; background:rgba(17,153,142,0.04); border: none;">
                                                {% timezone "Asia/Manila" %}{{ violation.timestamp|date:"M d, Y h:i A" }}{% endtimezone %}
                                            </td>
                                            <td style="padding: 14px 18px; text-align: center; background:rgba(240,147,251,0.04); border: none;">
                                                <a href="{% url 'violation_detail' violation.id %}" class="btn btn-sm btn-outline-primary" style="border-radius:18px; font-weight:600;">
                                                    <i class="fas fa-eye"></i> <span class="d-none d-sm-inline">View</span>
                                                </a>
                                            </td>
                                        </tr> {% endfor %} </tbody>
                                </table>
                            </div> {% else %} <div class="text-center py-4">
                                <i class="fas fa-check-circle text-success" style="font-size: 3rem;"></i>
                                <p class="text-muted mt-2">No violations detected recently</p>
                            </div> {% endif %}
                        </div>
                    </div>
                </div>
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        // --- Week filter for "This Month" chart and violation table ---
                        const weekFilter = document.getElementById('weekFilter');
                        const weekDailyCache = {}; // For quick lookup of week start/end
                        let weekDaily = [];
                        // Fetch weekDaily data for week date ranges
                        fetch('/api/statistics/').then(response => response.json()).then(data => {
                            weekDaily = data.month_weekly_daily || [];
                            weekDaily.forEach((week, idx) => {
                                // Find min/max date for the week
                                if (week.days && week.days.length) {
                                    weekDailyCache[idx] = {
                                        start: week.days[0].date,
                                        end: week.days[week.days.length - 1].date
                                    };
                                }
                            });
                        });
                        weekFilter.addEventListener('change', function() {
                            const val = weekFilter.value;
                            if (val === 'all') {
                                // Show all weeks as bar graph without reloading
                                if (typeof stats !== "undefined" && stats.length) {
                                    renderChart(stats.map(stat => stat.label), stats.map(stat => stat.count), 'This Month', "line");
                                }
                                return;
                            }
                            // Get week start/end
                            const weekIdx = parseInt(val, 10);
                            const weekInfo = weekDailyCache[weekIdx];
                            if (!weekInfo) return;
                            // Fetch violations for this week
                            fetch(`/api/violations_by_week/?start_date=${weekInfo.start}&end_date=${weekInfo.end}`).then(response => response.json()).then(data => {
                                const tbody = document.querySelector('.recent-violations-table tbody');
                                tbody.innerHTML = '';
                                if (data.violations && data.violations.length) {
                                    data.violations.forEach(v => {
                                        const row = document.createElement('tr');
                                        row.innerHTML = `
                                <td style="padding: 14px 18px; font-weight:600; color:#234C6A; background:rgba(118,75,162,0.04); border: none;">
                                    ${v.plate_number || 'Unknown'}
                                </td>
                                <td style="padding: 14px 18px; color:#3498db; background:rgba(52,152,219,0.04); border: none;">
                                    ${v.camera || 'Unknown Camera'}
                                </td>
                                <td style="padding: 14px 18px; color:#11998e; background:rgba(17,153,142,0.04); border: none;">
                                    ${v.timestamp}
                                </td>
                                <td style="padding: 14px 18px; text-align: center; background:rgba(240,147,251,0.04); border: none;">
                                    <a href="/violation/${v.id}/" class="btn btn-sm btn-outline-primary" style="border-radius:18px; font-weight:600;">
                                        <i class="fas fa-eye"></i> <span class="d-none d-sm-inline">View</span>
                                    </a>
                                </td>
                            `;
                                        tbody.appendChild(row);
                                    });
                                } else {
                                    tbody.innerHTML = `<tr><td colspan="4" class="text-center py-4">
                            <i class="fas fa-check-circle text-success" style="font-size: 2rem;"></i>
                            <p class="text-muted mt-2 mb-0">No violations detected for this week</p>
                        </td></tr>`;
                                }
                            });
                        });
                    });
                </script>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                    let todayHourlyChart = null;
                    async function loadStatistics() {
                        try {
                            const response = await fetch('/api/statistics/');
                            const data = await response.json();
                            if (data.today_hourly) {
                                createTodayHourlyChart(data.today_hourly);
                            }
                            // Optionally update summary or other charts here
                        } catch (error) {
                            console.error('Error loading statistics:', error);
                            document.getElementById('statsSummary').innerHTML = `
                            <div class="loading-stats">
                                <span>Error loading statistics</span>
                            </div>
                        `;
                        }
                    }

                    function createTodayHourlyChart(hourlyStats) {
                        // Group into 5 time blocks: 12am-4am, 4am-8am, 8am-12pm, 12pm-4pm, 4pm-12am
                        const blocks = [{
                            label: '12am-4am',
                            ampm: 'AM',
                            hours: [0, 1, 2, 3]
                        }, {
                            label: '4am-8am',
                            ampm: 'AM',
                            hours: [4, 5, 6, 7]
                        }, {
                            label: '8am-12pm',
                            ampm: 'AM',
                            hours: [8, 9, 10, 11]
                        }, {
                            label: '12pm-4pm',
                            ampm: 'PM',
                            hours: [12, 13, 14, 15]
                        }, {
                            label: '4pm-12am',
                            ampm: 'PM',
                            hours: [16, 17, 18, 19, 20, 21, 22, 23]
                        }];
                        const labels = blocks.map(b => b.label + ' ' + b.ampm);
                        const data = blocks.map(b => b.hours.reduce((sum, h) => sum + (hourlyStats[h] ? hourlyStats[h].count : 0), 0));
                        const ctx = document.getElementById('todayHourlyChart').getContext('2d');
                        if (todayHourlyChart) {
                            todayHourlyChart.destroy();
                        }
                        todayHourlyChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Violations',
                                    data: data,
                                    fill: true,
                                    backgroundColor: 'rgba(52, 152, 219, 0.15)',
                                    borderColor: 'rgba(52, 152, 219, 1)',
                                    borderWidth: 2,
                                    tension: 0.4,
                                    pointRadius: 7,
                                    pointBackgroundColor: 'rgba(52, 152, 219, 1)'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        color: '#234C6A',
                                        font: {
                                            size: 24,
                                            weight: 'bold',
                                            family: 'Segoe UI'
                                        },
                                        padding: {top: 10, bottom: 20}
                                    },
                                    tooltip: {
                                        enabled: true,
                                        backgroundColor: '#fff',
                                        titleColor: '#234C6A',
                                        bodyColor: '#234C6A',
                                        borderColor: '#3498db',
                                        borderWidth: 1.5,
                                        padding: 12,
                                        callbacks: {
                                            label: function(context) {
                                                return `Violations: ${context.parsed.y}`;
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: {
                                            color: 'rgba(52, 152, 219, 0.08)',
                                            borderDash: [4, 4]
                                        },
                                        ticks: {
                                            stepSize: 1,
                                            color: '#234C6A',
                                            font: {
                                                size: 16,
                                                weight: 'bold'
                                            }
                                        }
                                    },
                                    x: {
                                        grid: {
                                            color: 'rgba(52, 152, 219, 0.04)',
                                            display: true
                                        },
                                        ticks: {
                                            color: '#234C6A',
                                            font: {
                                                weight: 'bold',
                                                size: 16
                                            }
                                        }
                                    }
                                },
                            },
                            animation: {
                                duration: 1200,
                                easing: 'easeOutQuart'
                            }
                        });
                    }
                    document.addEventListener('DOMContentLoaded', function() {
                        loadStatistics();
                        // Only load once, do not loop every 5 seconds
                        setInterval(loadStatistics, 5000);
                    });
                </script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            </div>
            <!-- Add Enforcer Modal (copied from enforcer_list.html) -->
            <!-- Add Enforcer Modal removed as requested -->
    </body>
    </html>